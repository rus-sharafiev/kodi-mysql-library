(()=>{try{self["workbox:window:6.5.2"]&&_()}catch{}function x(t,r){return new Promise(function(e){var n=new MessageChannel;n.port1.onmessage=function(a){e(a.data)},t.postMessage(r,[n.port2])})}function A(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function L(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function H(t,r){var e;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(e=function(a,s){if(a){if(typeof a=="string")return L(a,s);var l=Object.prototype.toString.call(a).slice(8,-1);return l==="Object"&&a.constructor&&(l=a.constructor.name),l==="Map"||l==="Set"?Array.from(a):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?L(a,s):void 0}}(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(e=t[Symbol.iterator]()).next.bind(e)}try{self["workbox:core:6.5.2"]&&_()}catch{}var S=function(){var t=this;this.promise=new Promise(function(r,e){t.resolve=r,t.reject=e})};function T(t,r){var e=location.href;return new URL(t,e).href===new URL(r,e).href}var w=function(t,r){this.type=t,Object.assign(this,r)};function E(t,r,e){return e?r?r(t):t:(t&&t.then||(t=Promise.resolve(t)),r?t.then(r):t)}function N(){}var O={type:"SKIP_WAITING"};function C(t,r){if(!r)return t&&t.then?t.then(N):Promise.resolve()}var P=function(t){var r,e;function n(m,u){var i,o;return u===void 0&&(u={}),(i=t.call(this)||this).nn={},i.tn=0,i.rn=new S,i.en=new S,i.on=new S,i.un=0,i.an=new Set,i.cn=function(){var d=i.fn,c=d.installing;i.tn>0||!T(c.scriptURL,i.sn.toString())||performance.now()>i.un+6e4?(i.vn=c,d.removeEventListener("updatefound",i.cn)):(i.hn=c,i.an.add(c),i.rn.resolve(c)),++i.tn,c.addEventListener("statechange",i.ln)},i.ln=function(d){var c=i.fn,p=d.target,b=p.state,y=p===i.vn,k={sw:p,isExternal:y,originalEvent:d};!y&&i.mn&&(k.isUpdate=!0),i.dispatchEvent(new w(b,k)),b==="installed"?i.wn=self.setTimeout(function(){b==="installed"&&c.waiting===p&&i.dispatchEvent(new w("waiting",k))},200):b==="activating"&&(clearTimeout(i.wn),y||i.en.resolve(p))},i.dn=function(d){var c=i.hn,p=c!==navigator.serviceWorker.controller;i.dispatchEvent(new w("controlling",{isExternal:p,originalEvent:d,sw:c,isUpdate:i.mn})),p||i.on.resolve(c)},i.gn=(o=function(d){var c=d.data,p=d.ports,b=d.source;return E(i.getSW(),function(){i.an.has(b)&&i.dispatchEvent(new w("message",{data:c,originalEvent:d,ports:p,sw:b}))})},function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];try{return Promise.resolve(o.apply(this,d))}catch(p){return Promise.reject(p)}}),i.sn=m,i.nn=u,navigator.serviceWorker.addEventListener("message",i.gn),i}e=t,(r=n).prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e;var a,s,l,g=n.prototype;return g.register=function(m){var u=(m===void 0?{}:m).immediate,i=u!==void 0&&u;try{var o=this;return function(d,c){var p=d();return p&&p.then?p.then(c):c(p)}(function(){if(!i&&document.readyState!=="complete")return C(new Promise(function(d){return window.addEventListener("load",d)}))},function(){return o.mn=Boolean(navigator.serviceWorker.controller),o.yn=o.pn(),E(o.bn(),function(d){o.fn=d,o.yn&&(o.hn=o.yn,o.en.resolve(o.yn),o.on.resolve(o.yn),o.yn.addEventListener("statechange",o.ln,{once:!0}));var c=o.fn.waiting;return c&&T(c.scriptURL,o.sn.toString())&&(o.hn=c,Promise.resolve().then(function(){o.dispatchEvent(new w("waiting",{sw:c,wasWaitingBeforeRegister:!0}))}).then(function(){})),o.hn&&(o.rn.resolve(o.hn),o.an.add(o.hn)),o.fn.addEventListener("updatefound",o.cn),navigator.serviceWorker.addEventListener("controllerchange",o.dn),o.fn})})}catch(d){return Promise.reject(d)}},g.update=function(){try{return this.fn?C(this.fn.update()):void 0}catch(m){return Promise.reject(m)}},g.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},g.messageSW=function(m){try{return E(this.getSW(),function(u){return x(u,m)})}catch(u){return Promise.reject(u)}},g.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&x(this.fn.waiting,O)},g.pn=function(){var m=navigator.serviceWorker.controller;return m&&T(m.scriptURL,this.sn.toString())?m:void 0},g.bn=function(){try{var m=this;return function(u,i){try{var o=u()}catch(d){return i(d)}return o&&o.then?o.then(void 0,i):o}(function(){return E(navigator.serviceWorker.register(m.sn,m.nn),function(u){return m.un=performance.now(),u})},function(u){throw u})}catch(u){return Promise.reject(u)}},a=n,(s=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&A(a.prototype,s),l&&A(a,l),n}(function(){function t(){this.Pn=new Map}var r=t.prototype;return r.addEventListener=function(e,n){this.Sn(e).add(n)},r.removeEventListener=function(e,n){this.Sn(e).delete(n)},r.dispatchEvent=function(e){e.target=this;for(var n,a=H(this.Sn(e.type));!(n=a()).done;)(0,n.value)(e)},r.Sn=function(e){return this.Pn.has(e)||this.Pn.set(e,new Set),this.Pn.get(e)},t}());"serviceWorker"in navigator&&new P("/sw.js").register();var M=document.createElement("header"),W=document.createElement("nav"),j=document.createElement("main"),B=document.createElement("div");B.setAttribute("id","main-top");var f=document.createElement("div");f.setAttribute("id","main-container");var R=document.createElement("div");R.setAttribute("class","gradient-top");var q=document.createElement("div");q.setAttribute("class","gradient-bottom");j.append(B,f);var G=document.createElement("footer");document.body.onload=()=>{document.body.append(M,W,j,G),Z()};var D=async()=>{let t=$("/IMG/kodi-logo-with-text.svg","logo"),r=v("\u0414\u043E\u043C\u0430\u0448\u043D\u044F\u044F \u0431\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0444\u0438\u043B\u044C\u043C\u043E\u0432 \u0438 \u0441\u0435\u0440\u0438\u0430\u043B\u043E\u0432","span","title-in-header"),e=F(),n=K();return Promise.all([t,r,e,n])},F=async()=>{let t=document.createElement("input");return t.type="button",t.value="sort",t.setAttribute("class","mobile-sort material-symbols-rounded"),t.onclick=()=>{document.querySelector(".sort").offsetHeight==0?(document.querySelector(".sort").style.height="50px",document.querySelector(".sort").setAttribute("class","sort sort-shadow"),t.value="close"):(document.querySelector(".sort").style.height="0",document.querySelector(".sort").setAttribute("class","sort"),t.value="sort")},t},K=async()=>{let t=document.createElement("div");t.setAttribute("class","sort");let r=document.createElement("div");r.setAttribute("class","sort-button-container");let e=document.createElement("span");e.innerHTML="\u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E";let n=document.createElement("input");n.type="button",n.value="sort_by_alpha",n.id="title",n.setAttribute("class","sort-button material-symbols-rounded"),r.onclick=()=>{switch(n.id){case"title":n.id="rating",n.value="thumbs_up_down",e.innerHTML="\u043F\u043E \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0443",h(document.querySelector(".nav-active").id);break;case"rating":n.id="premiered",n.value="calendar_month",e.innerHTML="\u043F\u043E \u0432\u044B\u0445\u043E\u0434\u0443 \u0432 \u043F\u0440\u043E\u043A\u0430\u0442",h(document.querySelector(".nav-active").id);break;case"premiered":n.id="title",n.value="sort_by_alpha",e.innerHTML="\u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E",h(document.querySelector(".nav-active").id);break}},r.append(n,e);let a=document.createElement("div");a.setAttribute("class","order-button-container");let s=document.createElement("span");s.innerHTML="\u043F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E";let l=document.createElement("input");return l.type="button",l.value="Sort",l.id="asc",l.style="transform: scale(1, -1);",l.setAttribute("class","order-button material-symbols-rounded"),a.onclick=()=>{switch(l.id){case"asc":l.id="desc",l.style="transform: scale(1, 1);",s.innerHTML="\u043F\u043E \u0443\u0431\u044B\u0432\u0430\u043D\u0438\u044E",h(document.querySelector(".nav-active").id);break;case"desc":l.id="asc",l.style="transform: scale(1, -1);",s.innerHTML="\u043F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E",h(document.querySelector(".nav-active").id);break}},a.append(l,s),t.append(r,a),await document.fonts.load("24px Material Symbols Rounded"),t},I=async(t,r,e)=>{let n=document.createElement("div"),a=document.createTextNode(t),s=document.createElement("span"),l=document.createTextNode(r);return s.setAttribute("class","material-symbols-rounded"),s.appendChild(l),n.setAttribute("id",e),n.append(s,a),n.onclick=()=>h(e),await document.fonts.load("24px Material Symbols Rounded"),n},V=async()=>{let t=I("\u0424\u0438\u043B\u044C\u043C\u044B","Movie","movies"),r=I("\u0421\u0435\u0440\u0438\u0430\u043B\u044B","Videocam","tvs");return Promise.all([t,r])},$=async(t,r)=>{let e=new Image;return e.src=t,e.setAttribute("class",r),e},v=async(t,r,e)=>{if(t){let n=document.createElement(r),a=document.createTextNode(t);return n.appendChild(a),n.setAttribute("class",e),n}},z=async(t,r,e,n)=>{let a=document.createElement("a"),s=new Image(r);return s.src=t,a.setAttribute("href",e),a.setAttribute("target","_blank"),a.setAttribute("class",n),a.appendChild(s),a},U=async(t,r,e)=>{let n=t[r][e];return new Promise(a=>{let s=new Image;s.src=n,s.setAttribute("class",e),s.onload=()=>{a(s)}})},J=async(t,r)=>{let e=t[r].rating,n=document.createElement("div"),a=document.createTextNode(e.toFixed(1));switch(n.appendChild(a),n.setAttribute("class","rating"),!0){case e<5:n.style.backgroundImage="linear-gradient(160deg, rgba(220, 20, 60, 0) 80%, rgb(220, 20, 60) 100%)";break;case e<6:n.style.backgroundImage="linear-gradient(160deg, rgba(255, 0, 0, 0) 80%, rgb(255, 0, 0) 100%)";break;case e<6.5:n.style.backgroundImage="linear-gradient(160deg, rgba(255, 165, 0, 0) 80%, rgb(255, 165, 0) 100%)";break;case e<7:n.style.backgroundImage="linear-gradient(160deg, rgba(255, 215, 0, 0) 80%, rgb(255, 215, 0) 100%)";break;case e<8:n.style.backgroundImage="linear-gradient(160deg, rgba(154, 205, 50, 0) 80%, rgb(154, 205, 50) 100%)";break;case e<9:n.style.backgroundImage="linear-gradient(160deg, rgba(50, 205, 50, 0) 80%, rgb(50, 205, 50) 100%)";break;case e<10:n.style.backgroundImage="linear-gradient(160deg, rgba(0, 255, 0, 0) 80%, rgb(0, 255, 0) 100%)";break;case e>=10:n.style.backgroundImage="linear-gradient(160deg, rgba(0, 255, 0, 0) 80%, rgb(0, 255, 0) 100%)";break}return n},Q=async(t,r,e)=>{let n=U(t,e.id,"poster"),a=U(t,e.id,"fanart"),s=v(e.title,"div","title"),l=v(e.subtitle,"div","subtitle"),g=v(e.review,"div","review"),m=v(e.writer,"div","writer"),u=v(e.pg_rating,"div","pg-rating"),i=v(e.genre,"div","genre"),o=v(e.director,"div","director"),d=v(e.original_title,"div","original-title"),c=v(e.studio,"div","studio"),p=z("/IMG/yt.svg",80,e.youtube,"youtube"),b=v(e.premiered_date,"div","premiered-date"),y=J(r,e.id);return await Promise.all([n,a,s,l,g,m,u,i,o,d,c,p,b,y])},X=async t=>{let e=await(await fetch(t)).json(),a=await(await fetch("art.php")).json(),l=await(await fetch("rating.php")).json();return Promise.all(e.map(async m=>{let u=document.createElement("div");return u.setAttribute("class","tile"),(await Q(a,l,m)).map(o=>{o&&u.append(o)}),u}))},Y=(t,r,e,n)=>{t.sort((a,s)=>{if(r=="movies")switch(e){case"rating":fist=a.children[13].innerText.toUpperCase(),second=s.children[13].innerText.toUpperCase();break;case"title":fist=a.children[2].innerText.toUpperCase(),second=s.children[2].innerText.toUpperCase();break;case"premiered":fist=a.children[12].innerText.toUpperCase(),second=s.children[12].innerText.toUpperCase();break}else switch(e){case"rating":fist=a.children[9].innerText.toUpperCase(),second=s.children[9].innerText.toUpperCase();break;case"title":fist=a.children[2].innerText.toUpperCase(),second=s.children[2].innerText.toUpperCase();break;case"premiered":fist=a.children[8].innerText.toUpperCase(),second=s.children[8].innerText.toUpperCase();break}switch(n){case"asc":if(fist<second)return-1;if(fist>second)return 1;break;case"desc":if(fist<second)return 1;if(fist>second)return-1;break}return 0})},h=async t=>{switch(f.innerHTML='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',t){case"movies":db="mdb.php";break;case"tvs":db="tdb.php";break}let r=await X(db),e=document.querySelector(".sort-button").id,n=document.querySelector(".order-button").id;Y(r,t,e,n),f.innerHTML="",f.append(R,q),r.map(s=>f.append(s));let a=document.getElementsByClassName("nav-active");if(a.length>0)for(let s=0;s<a.length;s++)a[s].classList.remove("nav-active");document.getElementById(t).classList.add("nav-active"),history.pushState(t,"",t)},Z=async()=>{switch((await D()).map(e=>M.append(e)),(await V()).map(e=>W.append(e)),!0){case window.location.pathname=="/":h("movies");break;case window.location.pathname=="/movies":h("movies");break;case window.location.pathname=="/tvs":h("tvs");break}};window.onpopstate=()=>{h(history.state)};})();
