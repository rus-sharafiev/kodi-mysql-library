(()=>{try{self["workbox:window:6.5.2"]&&_()}catch{}function T(t,r){return new Promise(function(e){var n=new MessageChannel;n.port1.onmessage=function(a){e(a.data)},t.postMessage(r,[n.port2])})}function A(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function L(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function H(t,r){var e;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(e=function(a,s){if(a){if(typeof a=="string")return L(a,s);var l=Object.prototype.toString.call(a).slice(8,-1);return l==="Object"&&a.constructor&&(l=a.constructor.name),l==="Map"||l==="Set"?Array.from(a):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?L(a,s):void 0}}(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(e=t[Symbol.iterator]()).next.bind(e)}try{self["workbox:core:6.5.2"]&&_()}catch{}var S=function(){var t=this;this.promise=new Promise(function(r,e){t.resolve=r,t.reject=e})};function x(t,r){var e=location.href;return new URL(t,e).href===new URL(r,e).href}var w=function(t,r){this.type=t,Object.assign(this,r)};function E(t,r,e){return e?r?r(t):t:(t&&t.then||(t=Promise.resolve(t)),r?t.then(r):t)}function N(){}var O={type:"SKIP_WAITING"};function P(t,r){if(!r)return t&&t.then?t.then(N):Promise.resolve()}var C=function(t){var r,e;function n(m,u){var o,i;return u===void 0&&(u={}),(o=t.call(this)||this).nn={},o.tn=0,o.rn=new S,o.en=new S,o.on=new S,o.un=0,o.an=new Set,o.cn=function(){var d=o.fn,c=d.installing;o.tn>0||!x(c.scriptURL,o.sn.toString())||performance.now()>o.un+6e4?(o.vn=c,d.removeEventListener("updatefound",o.cn)):(o.hn=c,o.an.add(c),o.rn.resolve(c)),++o.tn,c.addEventListener("statechange",o.ln)},o.ln=function(d){var c=o.fn,p=d.target,f=p.state,y=p===o.vn,k={sw:p,isExternal:y,originalEvent:d};!y&&o.mn&&(k.isUpdate=!0),o.dispatchEvent(new w(f,k)),f==="installed"?o.wn=self.setTimeout(function(){f==="installed"&&c.waiting===p&&o.dispatchEvent(new w("waiting",k))},200):f==="activating"&&(clearTimeout(o.wn),y||o.en.resolve(p))},o.dn=function(d){var c=o.hn,p=c!==navigator.serviceWorker.controller;o.dispatchEvent(new w("controlling",{isExternal:p,originalEvent:d,sw:c,isUpdate:o.mn})),p||o.on.resolve(c)},o.gn=(i=function(d){var c=d.data,p=d.ports,f=d.source;return E(o.getSW(),function(){o.an.has(f)&&o.dispatchEvent(new w("message",{data:c,originalEvent:d,ports:p,sw:f}))})},function(){for(var d=[],c=0;c<arguments.length;c++)d[c]=arguments[c];try{return Promise.resolve(i.apply(this,d))}catch(p){return Promise.reject(p)}}),o.sn=m,o.nn=u,navigator.serviceWorker.addEventListener("message",o.gn),o}e=t,(r=n).prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e;var a,s,l,v=n.prototype;return v.register=function(m){var u=(m===void 0?{}:m).immediate,o=u!==void 0&&u;try{var i=this;return function(d,c){var p=d();return p&&p.then?p.then(c):c(p)}(function(){if(!o&&document.readyState!=="complete")return P(new Promise(function(d){return window.addEventListener("load",d)}))},function(){return i.mn=Boolean(navigator.serviceWorker.controller),i.yn=i.pn(),E(i.bn(),function(d){i.fn=d,i.yn&&(i.hn=i.yn,i.en.resolve(i.yn),i.on.resolve(i.yn),i.yn.addEventListener("statechange",i.ln,{once:!0}));var c=i.fn.waiting;return c&&x(c.scriptURL,i.sn.toString())&&(i.hn=c,Promise.resolve().then(function(){i.dispatchEvent(new w("waiting",{sw:c,wasWaitingBeforeRegister:!0}))}).then(function(){})),i.hn&&(i.rn.resolve(i.hn),i.an.add(i.hn)),i.fn.addEventListener("updatefound",i.cn),navigator.serviceWorker.addEventListener("controllerchange",i.dn),i.fn})})}catch(d){return Promise.reject(d)}},v.update=function(){try{return this.fn?P(this.fn.update()):void 0}catch(m){return Promise.reject(m)}},v.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},v.messageSW=function(m){try{return E(this.getSW(),function(u){return T(u,m)})}catch(u){return Promise.reject(u)}},v.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&T(this.fn.waiting,O)},v.pn=function(){var m=navigator.serviceWorker.controller;return m&&x(m.scriptURL,this.sn.toString())?m:void 0},v.bn=function(){try{var m=this;return function(u,o){try{var i=u()}catch(d){return o(d)}return i&&i.then?i.then(void 0,o):i}(function(){return E(navigator.serviceWorker.register(m.sn,m.nn),function(u){return m.un=performance.now(),u})},function(u){throw u})}catch(u){return Promise.reject(u)}},a=n,(s=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&A(a.prototype,s),l&&A(a,l),n}(function(){function t(){this.Pn=new Map}var r=t.prototype;return r.addEventListener=function(e,n){this.Sn(e).add(n)},r.removeEventListener=function(e,n){this.Sn(e).delete(n)},r.dispatchEvent=function(e){e.target=this;for(var n,a=H(this.Sn(e.type));!(n=a()).done;)(0,n.value)(e)},r.Sn=function(e){return this.Pn.has(e)||this.Pn.set(e,new Set),this.Pn.get(e)},t}());"serviceWorker"in navigator&&new C("/sw.js").register();var M=document.createElement("header"),W=document.createElement("nav"),j=document.createElement("main"),R=document.createElement("div");R.setAttribute("id","main-top");var b=document.createElement("div");b.setAttribute("id","main-container");var B=document.createElement("div");B.setAttribute("class","gradient-top");var q=document.createElement("div");q.setAttribute("class","gradient-bottom");j.append(R,b);var G=document.createElement("footer");document.body.onload=()=>{document.body.append(M,W,j,G),ee()};var D=async()=>{let t=z("/IMG/kodi-logo-with-text.svg","logo"),r=g("\u0414\u043E\u043C\u0430\u0448\u043D\u044F\u044F \u0431\u0438\u0431\u043B\u0438\u043E\u0442\u0435\u043A\u0430 \u0444\u0438\u043B\u044C\u043C\u043E\u0432 \u0438 \u0441\u0435\u0440\u0438\u0430\u043B\u043E\u0432","span","title-in-header"),e=F(),n=K();return Promise.all([t,r,e,n])},F=async()=>{let t=document.createElement("input");return t.type="button",t.value="sort",t.setAttribute("class","mobile-sort material-symbols-rounded"),t.onclick=()=>{document.querySelector(".sort").offsetHeight==0?(document.querySelector(".sort").style.height="50px",document.querySelector(".sort").setAttribute("class","sort sort-shadow"),t.value="close"):(document.querySelector(".sort").style.height="0",document.querySelector(".sort").setAttribute("class","sort"),t.value="sort")},t},K=async()=>{let t=document.createElement("div");t.setAttribute("class","sort");let r=document.createElement("div");r.setAttribute("class","sort-button-container");let e=document.createElement("span");e.innerHTML="\u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E";let n=document.createElement("input");n.type="button",n.value="sort_by_alpha",n.id="title",n.setAttribute("class","sort-button material-symbols-rounded"),r.onclick=()=>{switch(n.id){case"title":n.id="rating",n.value="thumbs_up_down",e.innerHTML="\u043F\u043E \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0443",h(document.querySelector(".nav-active").id);break;case"rating":n.id="premiered",n.value="calendar_month",e.innerHTML="\u043F\u043E \u0432\u044B\u0445\u043E\u0434\u0443 \u0432 \u043F\u0440\u043E\u043A\u0430\u0442",h(document.querySelector(".nav-active").id);break;case"premiered":n.id="title",n.value="sort_by_alpha",e.innerHTML="\u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E",h(document.querySelector(".nav-active").id);break}},r.append(n,e);let a=document.createElement("div");a.setAttribute("class","order-button-container");let s=document.createElement("span");s.innerHTML="\u043F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E";let l=document.createElement("input");return l.type="button",l.value="Sort",l.id="asc",l.style="transform: scale(1, -1);",l.setAttribute("class","order-button material-symbols-rounded"),a.onclick=()=>{switch(l.id){case"asc":l.id="desc",l.style="transform: scale(1, 1);",s.innerHTML="\u043F\u043E \u0443\u0431\u044B\u0432\u0430\u043D\u0438\u044E",h(document.querySelector(".nav-active").id);break;case"desc":l.id="asc",l.style="transform: scale(1, -1);",s.innerHTML="\u043F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E",h(document.querySelector(".nav-active").id);break}},a.append(l,s),t.append(r,a),await document.fonts.load("24px Material Symbols Rounded"),t},I=async(t,r,e)=>{let n=document.createElement("div"),a=document.createTextNode(t),s=document.createElement("span"),l=document.createTextNode(r);return s.setAttribute("class","material-symbols-rounded"),s.appendChild(l),n.setAttribute("id",e),n.append(s,a),n.onclick=()=>h(e),await document.fonts.load("24px Material Symbols Rounded"),n},V=async()=>{let t=I("\u0424\u0438\u043B\u044C\u043C\u044B","Movie","movies"),r=I("\u0421\u0435\u0440\u0438\u0430\u043B\u044B","Videocam","tvs");return Promise.all([t,r])},$=t=>t?"https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=2592000&url="+encodeURIComponent(t):void 0,z=async(t,r)=>new Promise(e=>{let n=new Image;n.src=t,n.setAttribute("class",r),n.onload=()=>{e(n)}}),g=async(t,r,e)=>{if(t){let n=document.createElement(r),a=document.createTextNode(t);return n.appendChild(a),n.setAttribute("class",e),n}},J=async(t,r,e,n)=>{let a=document.createElement("a"),s=new Image(r);return s.src=t,a.setAttribute("href",e),a.setAttribute("target","_blank"),a.setAttribute("class",n),a.appendChild(s),a},U=async(t,r,e)=>{let n=$(t[r][e]);return new Promise(a=>{let s=new Image;s.src=n,s.setAttribute("class",e),s.onload=()=>{a(s)}})},Q=async(t,r)=>{let e=t[r].rating,n=document.createElement("div"),a=document.createTextNode(e.toFixed(1));switch(n.appendChild(a),n.setAttribute("class","rating"),!0){case e<5:n.style.backgroundImage="linear-gradient(160deg, rgba(220, 20, 60, 0) 80%, rgb(220, 20, 60) 100%)";break;case e<6:n.style.backgroundImage="linear-gradient(160deg, rgba(255, 0, 0, 0) 80%, rgb(255, 0, 0) 100%)";break;case e<6.5:n.style.backgroundImage="linear-gradient(160deg, rgba(255, 165, 0, 0) 80%, rgb(255, 165, 0) 100%)";break;case e<7:n.style.backgroundImage="linear-gradient(160deg, rgba(255, 215, 0, 0) 80%, rgb(255, 215, 0) 100%)";break;case e<8:n.style.backgroundImage="linear-gradient(160deg, rgba(154, 205, 50, 0) 80%, rgb(154, 205, 50) 100%)";break;case e<9:n.style.backgroundImage="linear-gradient(160deg, rgba(50, 205, 50, 0) 80%, rgb(50, 205, 50) 100%)";break;case e<10:n.style.backgroundImage="linear-gradient(160deg, rgba(0, 255, 0, 0) 80%, rgb(0, 255, 0) 100%)";break;case e>=10:n.style.backgroundImage="linear-gradient(160deg, rgba(0, 255, 0, 0) 80%, rgb(0, 255, 0) 100%)";break}return n},X=async(t,r,e)=>{let n=U(t,e.id,"poster"),a=U(t,e.id,"fanart"),s=g(e.title,"div","title"),l=g(e.subtitle,"div","subtitle"),v=g(e.review,"div","review"),m=g(e.writer,"div","writer"),u=g(e.pg_rating,"div","pg-rating"),o=g(e.genre,"div","genre"),i=g(e.director,"div","director"),d=g(e.original_title,"div","original-title"),c=g(e.studio,"div","studio"),p=J("/IMG/yt.svg",80,e.youtube,"youtube"),f=g(e.premiered_date,"div","premiered-date"),y=Q(r,e.id);return await Promise.all([n,a,s,l,v,m,u,o,i,d,c,p,f,y])},Y=async t=>{let e=await(await fetch(t)).json(),a=await(await fetch("art.php")).json(),l=await(await fetch("rating.php")).json();return Promise.all(e.map(async m=>{let u=document.createElement("div");return u.setAttribute("class","tile"),(await X(a,l,m)).map(i=>{i&&u.append(i)}),u}))},Z=(t,r,e,n)=>{t.sort((a,s)=>{if(r=="movies")switch(e){case"rating":fist=a.children[13].innerText.toUpperCase(),second=s.children[13].innerText.toUpperCase();break;case"title":fist=a.children[2].innerText.toUpperCase(),second=s.children[2].innerText.toUpperCase();break;case"premiered":fist=a.children[12].innerText.toUpperCase(),second=s.children[12].innerText.toUpperCase();break}else switch(e){case"rating":fist=a.children[9].innerText.toUpperCase(),second=s.children[9].innerText.toUpperCase();break;case"title":fist=a.children[2].innerText.toUpperCase(),second=s.children[2].innerText.toUpperCase();break;case"premiered":fist=a.children[8].innerText.toUpperCase(),second=s.children[8].innerText.toUpperCase();break}switch(n){case"asc":if(fist<second)return-1;if(fist>second)return 1;break;case"desc":if(fist<second)return 1;if(fist>second)return-1;break}return 0})},h=async t=>{switch(b.innerHTML='<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>',t){case"movies":db="mdb.php";break;case"tvs":db="tdb.php";break}let r=await Y(db),e=document.querySelector(".sort-button").id,n=document.querySelector(".order-button").id;Z(r,t,e,n),b.innerHTML="",b.append(B,q),r.map(s=>b.append(s));let a=document.getElementsByClassName("nav-active");if(a.length>0)for(let s=0;s<a.length;s++)a[s].classList.remove("nav-active");document.getElementById(t).classList.add("nav-active"),history.pushState(t,"",t)},ee=async()=>{switch((await D()).map(e=>M.append(e)),(await V()).map(e=>W.append(e)),!0){case window.location.pathname=="/":h("movies");break;case window.location.pathname=="/movies":h("movies");break;case window.location.pathname=="/tvs":h("tvs");break}};window.onpopstate=()=>{h(history.state)};})();
